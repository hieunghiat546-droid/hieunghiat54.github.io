<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trang Lá»›p - 10A1 (Full)</title>
  <meta name="theme-color" content="#ff5c8a" />
  <style>
    :root{--accent:#ff5c8a;--bg:#f7f7fb;--card:#ffffff;--muted:#666}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial;background:var(--bg);color:#111}
    header{background:linear-gradient(90deg,#ffd1dc10 0,#ffd1dc);padding:14px 18px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo-img{width:72px;height:72px;border-radius:12px;object-fit:cover;border:3px solid var(--accent);background:#fff}
    h1{font-size:18px;margin:0}
    nav{display:flex;gap:8px}
    button{background:none;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    .container{max-width:1200px;margin:18px auto;padding:0 16px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:1000px){.grid{grid-template-columns:300px 1fr}}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(11,7,21,0.05)}
    .muted{color:var(--muted);font-size:13px}
    .ann-list{display:flex;flex-direction:column;gap:8px}
    .ann{padding:10px;border-radius:8px;background:#fff7fb;border:1px solid #ffe0ec}
    input[type=text],textarea,select{width:100%;padding:8px;border-radius:8px;border:1px solid #e6e6ee;margin-top:6px}
    .small{font-size:13px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #f1f1f6;text-align:left}
    .actions{display:flex;gap:8px}
    .btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
    .ghost{background:transparent;border:1px solid #eee;color:#333}
    footer{padding:14px;text-align:center;color:var(--muted);font-size:13px}
    .flex{display:flex;gap:8px;align-items:center}
    .uploader{display:flex;gap:8px;align-items:center}
    .gallery img{width:120px;height:80px;object-fit:cover;border-radius:8px}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <img id="logoImg" src="10a1.jpg" alt="Logo lá»›p" class="logo-img">
      <div>
        <h1 id="classTitle">Lá»›p 10A1 â€” Tri thá»©c dáº«n lá»‘i</h1>
        <div class="muted">NiÃªn khÃ³a 2025â€“2026 Â· Quáº£n trá»‹ viÃªn: GiÃ¡o viÃªn chá»§ nhiá»‡m</div>
      </div>
    </div>
    <nav>
      <button id="uploadLogoBtn" title="Äá»•i logo">ğŸ–¼ Äá»•i logo</button>
      <button id="toggleDark" title="Báº­t/táº¯t cháº¿ Ä‘á»™ tá»‘i">ğŸŒ™</button>
      <button id="printBtn" title="In trang lá»›p">ğŸ–¨ In</button>
      <button id="resetBtn" title="XÃ³a dá»¯ liá»‡u local">ğŸ§¹ Reset</button>
    </nav>
  </header>

  <main class="container">
    <div class="grid">
      <aside>
        <section class="card">
          <h3>ThÃ´ng bÃ¡o nhanh</h3>
          <div class="ann-list" id="annList"></div>
          <hr style="margin:10px 0">
          <input id="annTitle" placeholder="TiÃªu Ä‘á»" />
          <textarea id="annContent" rows="3" placeholder="Ná»™i dung thÃ´ng bÃ¡o"></textarea>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="btn" id="addAnn">ThÃªm thÃ´ng bÃ¡o</button>
            <button class="ghost" id="clearAnns">XÃ³a táº¥t cáº£</button>
          </div>
        </section>

        <section class="card" style="margin-top:12px">
          <h3>Danh sÃ¡ch lá»›p</h3>
          <div class="muted small">ThÃªm/sá»­a nhanh, xuáº¥t CSV</div>
          <div style="margin-top:8px;display:flex;flex-direction:column;gap:8px">
            <input id="stuName" placeholder="Há» tÃªn" />
            <div class="flex"><input id="stuRoll" placeholder="Sá»‘ bÃ¡o danh" style="width:120px" /><input id="stuClass" placeholder="Lá»›p" style="width:120px" /></div>
            <div style="display:flex;gap:8px">
              <button class="btn" id="addStu">ThÃªm</button>
              <button class="ghost" id="exportCSV">Xuáº¥t CSV</button>
            </div>
          </div>
          <div style="margin-top:12px;max-height:240px;overflow:auto">
            <table id="stuTable"><thead><tr><th>#</th><th>Há» tÃªn</th><th>SBÄ</th><th>Lá»›p</th><th></th></tr></thead><tbody></tbody></table>
          </div>
        </section>

        <section class="card" style="margin-top:12px">
          <h3>Báº£ng Ä‘iá»ƒm</h3>
          <div class="muted small">Chá»n há»c sinh Ä‘á»ƒ thÃªm Ä‘iá»ƒm tá»«ng mÃ´n</div>
          <select id="gradeStudent"><option value="">-- Chá»n há»c sinh --</option></select>
          <div class="flex" style="margin-top:8px"><input id="gradeSubject" placeholder="MÃ´n" /><input id="gradeScore" placeholder="Äiá»ƒm" style="width:120px" /></div>
          <div style="margin-top:8px"><button class="btn" id="addGrade">ThÃªm Ä‘iá»ƒm</button></div>
          <div style="margin-top:12px;max-height:160px;overflow:auto"><table id="gradeTable"><thead><tr><th>Há»c sinh</th><th>MÃ´n</th><th>Äiá»ƒm</th><th></th></tr></thead><tbody></tbody></table></div>
          <div style="margin-top:8px"><button class="ghost" id="computeRank">TÃ­nh trung bÃ¬nh & Xáº¿p háº¡ng</button></div>
          <div style="margin-top:8px"><table id="rankTable"><thead><tr><th>Há»c sinh</th><th>TB</th><th>Xáº¿p háº¡ng</th></tr></thead><tbody></tbody></table></div>
        </section>

      </aside>

      <section>
        <div class="card">
          <h2>Lá»‹ch há»c</h2>
          <div class="muted small">Nháº­p ngÃ y/giá» - mÃ´n - ghi chÃº</div>
          <div style="display:flex;gap:8px;margin-top:8px"><input id="schDate" placeholder="YYYY-MM-DD" /><input id="schTime" placeholder="Tiáº¿t" /><input id="schTopic" placeholder="MÃ´n / Chá»§ Ä‘á»" /><button class="btn" id="addSch">ThÃªm</button></div>
          <div style="margin-top:12px"><table id="schTable"><thead><tr><th>NgÃ y</th><th>Tiáº¿t</th><th>Chá»§ Ä‘á»</th><th></th></tr></thead><tbody></tbody></table></div>
        </div>

        <div class="card" style="margin-top:16px">
          <h2>BÃ i táº­p & Deadline</h2>
          <div class="muted small">Ghi bÃ i táº­p theo mÃ´n, Ä‘áº·t háº¡n ná»™p</div>
          <div style="display:flex;gap:8px;margin-top:8px"><input id="taskSubject" placeholder="MÃ´n" /><input id="taskTitle" placeholder="TiÃªu Ä‘á»" /><input id="taskDue" placeholder="Háº¡n (YYYY-MM-DD)" /><button class="btn" id="addTask">ThÃªm</button></div>
          <div style="margin-top:12px"><table id="taskTable"><thead><tr><th>MÃ´n</th><th>TiÃªu Ä‘á»</th><th>Háº¡n</th><th></th></tr></thead><tbody></tbody></table></div>
        </div>

        <div class="card" style="margin-top:16px">
          <h2>ThÆ° viá»‡n tÃ i liá»‡u</h2>
          <div class="muted small">ThÃªm link tÃ i liá»‡u hoáº·c upload file (lÆ°u local)</div>
          <div style="display:flex;gap:8px;margin-top:8px"><input id="docTitle" placeholder="TiÃªu Ä‘á»" /><input id="docUrl" placeholder="Link (hoáº·c bá» trá»‘ng Ä‘á»ƒ upload)" /><input id="docFile" type="file" /></div>
          <div style="margin-top:8px"><button class="btn" id="addDoc">ThÃªm tÃ i liá»‡u</button></div>
          <div style="margin-top:12px"><ul id="docList"></ul></div>
        </div>

        <div class="card" style="margin-top:16px">
          <h2>Gallery ká»· niá»‡m</h2>
          <div class="muted small">Upload áº£nh Ä‘á»ƒ hiá»ƒn thá»‹ (lÆ°u local)</div>
          <div class="uploader" style="margin-top:8px"><input id="galleryFile" type="file" accept="image/*" multiple /><button class="btn" id="addGallery">Upload</button></div>
          <div class="gallery" id="gallery" style="margin-top:12px;display:flex;flex-wrap:wrap;gap:8px"></div>
        </div>

      </section>
    </div>
  </main>

  <footer>.Lá»›p 10A1 - 2025_2026.
    Thiáº¿t káº¿ bá»Ÿi TrÆ°Æ¡ng Hiáº¿u NghÄ©a
  </footer>

  <input id="logoInput" type="file" accept="image/*" style="display:none">

  <script>
    // --- Helpers & state ---
    const $ = id=>document.getElementById(id)
    const storageKey = 'class_full_v1'
    const defaultState = {
      title: 'Lá»›p 10A1 â€” Tri thá»©c dáº«n lá»‘i',
      logo: '10a1.jpg',
      announcements: [],
      students: [],
      schedule: [],
      tasks: [],
      docs: [],
      gallery: [],
      grades: [] // {studentId, subject, score}
    }
    let state = JSON.parse(localStorage.getItem(storageKey) || 'null') || defaultState

    function save(){ localStorage.setItem(storageKey, JSON.stringify(state)) }

    // --- Render ---
    function renderAll(){
      $('classTitle').textContent = state.title
      $('logoImg').src = state.logo
      renderAnns(); renderStudents(); renderGradeStudentSelect(); renderSchedule(); renderTasks(); renderDocs(); renderGallery(); renderGrades(); renderRanks()
    }

    function renderAnns(){ const el=$('annList'); el.innerHTML=''; if(!state.announcements.length) el.innerHTML='<div class="muted">ChÆ°a cÃ³ thÃ´ng bÃ¡o nÃ o â€” thÃªm Ä‘i!</div>'
      state.announcements.slice().reverse().forEach((a,i)=>{ const div=document.createElement('div'); div.className='ann'; div.innerHTML=`<strong>${a.title}</strong><div class="muted small">${new Date(a.t).toLocaleString()}</div><p style="margin:8px 0">${a.content}</p><div style="text-align:right"><button class=\"ghost\" data-i=${i}>XÃ³a</button></div>`; el.appendChild(div) })
      el.querySelectorAll('button[data-i]').forEach(b=>b.onclick=e=>{ state.announcements.splice(state.announcements.length-1-parseInt(e.target.dataset.i),1); save(); renderAnns() }) }

    function renderStudents(){ const tbody=document.querySelector('#stuTable tbody'); tbody.innerHTML=''; state.students.forEach((s,i)=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${i+1}</td><td>${s.name}</td><td>${s.roll||''}</td><td>${s.cl||''}</td><td><div class="actions"><button class="ghost" data-i=${i} data-act=edit>âœï¸</button><button class="ghost" data-i=${i} data-act=del>ğŸ—‘</button></div></td>`; tbody.appendChild(tr) })
      tbody.querySelectorAll('button').forEach(b=>b.onclick=e=>{ const i=parseInt(e.target.dataset.i); const act=e.target.dataset.act; if(act==='del'){ if(confirm('XÃ³a há»c sinh?')){ state.students.splice(i,1); // remove grades too
            state.grades = state.grades.filter(g=>g.studentId!==state.students[i]?.id)
            save(); renderAll(); }
        } else if(act==='edit'){ const name=prompt('Sá»­a tÃªn', state.students[i].name); if(name!==null){ state.students[i].name=name; save(); renderStudents(); renderGradeStudentSelect(); } } }) }

    function renderGradeStudentSelect(){ const sel=$('gradeStudent'); sel.innerHTML='<option value="">-- Chá»n há»c sinh --</option>'; state.students.forEach(s=>sel.innerHTML+=`<option value="${s.id}">${s.name}</option>`) }

    function renderSchedule(){ const tbody=document.querySelector('#schTable tbody'); tbody.innerHTML=''; state.schedule.forEach((s,i)=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${s.date}</td><td>${s.time}</td><td>${s.topic}</td><td><button class=\"ghost\" data-i=${i}>XÃ³a</button></td>`; tbody.appendChild(tr) }); tbody.querySelectorAll('button').forEach(b=>b.onclick=e=>{ state.schedule.splice(parseInt(e.target.dataset.i),1); save(); renderSchedule() }) }

    function renderTasks(){ const tbody=document.querySelector('#taskTable tbody'); tbody.innerHTML=''; state.tasks.forEach((t,i)=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${t.subject}</td><td>${t.title}</td><td>${t.due}</td><td><button class=\"ghost\" data-i=${i}>XÃ³a</button></td>`; tbody.appendChild(tr) }); tbody.querySelectorAll('button').forEach(b=>b.onclick=e=>{ state.tasks.splice(parseInt(e.target.dataset.i),1); save(); renderTasks() }) }

    function renderDocs(){ const el=$('docList'); el.innerHTML=''; if(!state.docs.length) el.innerHTML='<li class="muted">ChÆ°a cÃ³ tÃ i liá»‡u</li>'
      state.docs.forEach((d,i)=>{ const li=document.createElement('li'); if(d.url){ li.innerHTML=`<strong>${d.title}</strong> â€” <a href="${d.url}" target="_blank">Má»Ÿ link</a> <button class=\"ghost\" data-i=${i}>XÃ³a</button>` } else { li.innerHTML=`<strong>${d.title}</strong> â€” <a href='${d.data}' target='_blank' download='${d.title}'>Táº£i file</a> <button class=\"ghost\" data-i=${i}>XÃ³a</button>` } el.appendChild(li) })
      el.querySelectorAll('button').forEach(b=>b.onclick=e=>{ state.docs.splice(parseInt(e.target.dataset.i),1); save(); renderDocs() }) }

    function renderGallery(){ const el=$('gallery'); el.innerHTML=''; if(!state.gallery.length) el.innerHTML='<div class="muted">ChÆ°a cÃ³ áº£nh</div>'
      state.gallery.forEach((d,i)=>{ const img=document.createElement('img'); img.src=d; img.title='áº¢nh ká»· niá»‡m'; img.onclick=()=>window.open(d,'_blank'); el.appendChild(img) }) }

    function renderGrades(){ const tbody=document.querySelector('#gradeTable tbody'); tbody.innerHTML=''; state.grades.forEach((g,i)=>{ const student = state.students.find(s=>s.id===g.studentId); const tr=document.createElement('tr'); tr.innerHTML=`<td>${student?student.name:'(khÃ´ng tá»“n táº¡i)'}</td><td>${g.subject}</td><td>${g.score}</td><td><button class=\"ghost\" data-i=${i}>XÃ³a</button></td>`; tbody.appendChild(tr) })
      tbody.querySelectorAll('button').forEach(b=>b.onclick=e=>{ state.grades.splice(parseInt(e.target.dataset.i),1); save(); renderGrades(); renderRanks() }) }

    function renderRanks(){ const tbody=document.querySelector('#rankTable tbody'); tbody.innerHTML=''; if(!state.students.length){ tbody.innerHTML='<tr><td colspan=3 class="muted">ChÆ°a cÃ³ há»c sinh</td></tr>'; return }
      const map = {}
      state.students.forEach(s=>map[s.id]={name:s.name,total:0,count:0,avg:0})
      state.grades.forEach(g=>{ if(map[g.studentId]){ map[g.studentId].total+=parseFloat(g.score); map[g.studentId].count+=1 } })
      const arr = Object.values(map).map(m=>({name:m.name,avg: m.count? (m.total/m.count):0}))
      arr.sort((a,b)=>b.avg-a.avg)
      arr.forEach((r,i)=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${r.name}</td><td>${r.avg.toFixed(2)}</td><td>${i+1}</td>`; tbody.appendChild(tr) }) }

    // --- Actions ---
    $('addAnn').onclick=()=>{ const title=$('annTitle').value.trim()||'KhÃ´ng cÃ³ tiÃªu Ä‘á»'; const content=$('annContent').value.trim(); state.announcements.push({title,content,t:Date.now()}); $('annTitle').value=''; $('annContent').value=''; save(); renderAnns() }
    $('clearAnns').onclick=()=>{ if(confirm('XÃ³a táº¥t cáº£ thÃ´ng bÃ¡o?')){ state.announcements=[]; save(); renderAnns() } }

    function newid(prefix='id'){ return prefix+Math.random().toString(36).slice(2,9) }

    $('addStu').onclick=()=>{ const name=$('stuName').value.trim(); const roll=$('stuRoll').value.trim(); const cl=$('stuClass').value.trim(); if(!name){ alert('Nháº­p tÃªn Ä‘i báº¡n'); return } const id=newid('s_'); state.students.push({id,name,roll,cl}); $('stuName').value=''; $('stuRoll').value=''; $('stuClass').value=''; save(); renderStudents(); renderGradeStudentSelect(); }

    $('exportCSV').onclick=()=>{ if(!state.students.length){ alert('ChÆ°a cÃ³ há»c sinh'); return } const rows=[['STT','Ho Ten','So Bao Dan','Lop']]; state.students.forEach((s,i)=>rows.push([i+1,s.name,s.roll||'',s.cl||''])); const csv = rows.map(r=>r.map(c=>`"${(''+(c||'')).replace(/"/g,'""')}"`).join(',')).join('\n'); const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'}), url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='danh_sach_lop.csv'; a.click(); URL.revokeObjectURL(url) }

    $('addSch').onclick=()=>{ const date=$('schDate').value.trim(); const time=$('schTime').value.trim(); const topic=$('schTopic').value.trim(); if(!date||!time||!topic){ alert('Nháº­p Ä‘á»§ ngÃ y-tiáº¿t-chá»§ Ä‘á»'); return } state.schedule.push({date,time,topic}); $('schDate').value=''; $('schTime').value=''; $('schTopic').value=''; save(); renderSchedule() }

    $('addTask').onclick=()=>{ const subject=$('taskSubject').value.trim(); const title=$('taskTitle').value.trim(); const due=$('taskDue').value.trim(); if(!subject||!title||!due){ alert('Nháº­p Ä‘á»§ thÃ´ng tin'); return } state.tasks.push({subject,title,due}); $('taskSubject').value=''; $('taskTitle').value=''; $('taskDue').value=''; save(); renderTasks() }

    $('addDoc').onclick=async()=>{ const title=$('docTitle').value.trim()||'TÃ i liá»‡u'; const url=$('docUrl').value.trim(); const file=$('docFile').files[0]; if(!url && !file){ alert('Bá» link hoáº·c chá»n file Ä‘á»ƒ lÆ°u'); return }
      if(url){ state.docs.push({title,url}); } else { const data = await fileToDataUrl(file); state.docs.push({title,data}); }
      $('docTitle').value=''; $('docUrl').value=''; $('docFile').value=''; save(); renderDocs(); }

    $('addGallery').onclick=async()=>{ const files=$('galleryFile').files; if(!files.length){ alert('Chá»n áº£nh Ä‘á»ƒ upload'); return } for(const f of files){ const data=await fileToDataUrl(f); state.gallery.push(data); } $('galleryFile').value=''; save(); renderGallery(); }

    async function fileToDataUrl(file){ return new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=()=>rej(); r.readAsDataURL(file); }) }

    $('addGrade').onclick=()=>{ const sid=$('gradeStudent').value; const subject=$('gradeSubject').value.trim(); const score=parseFloat($('gradeScore').value); if(!sid||!subject||isNaN(score)){ alert('Chá»n há»c sinh, mÃ´n vÃ  nháº­p Ä‘iá»ƒm há»£p lá»‡'); return } state.grades.push({studentId:sid,subject,score}); $('gradeSubject').value=''; $('gradeScore').value=''; save(); renderGrades(); }

    $('computeRank').onclick=()=>{ renderRanks(); alert('ÄÃ£ tÃ­nh xong (dá»±a trÃªn Ä‘iá»ƒm Ä‘Ã£ nháº­p)') }

    // logo change
    $('uploadLogoBtn').onclick=()=>$('logoInput').click()
    $('logoInput').addEventListener('change', async(e)=>{ const f=e.target.files[0]; if(!f) return; const data=await fileToDataUrl(f); state.logo=data; save(); $('logoImg').src=data })

    // gallery image click handled in render

    // misc
    $('printBtn').onclick=()=>window.print()
    $('resetBtn').onclick=()=>{ if(confirm('XÃ³a háº¿t dá»¯ liá»‡u cá»¥c bá»™?')){ localStorage.removeItem(storageKey); state = JSON.parse(JSON.stringify(defaultState)); save(); renderAll(); } }

    // dark mode simple
    $('toggleDark').onclick=()=>{ document.body.style.background = document.body.style.background? '': '#071024'; document.body.style.color = document.body.style.color==='white'?'#111':'#fff' }

    // save before close
    window.addEventListener('beforeunload', save)

    // init
    renderAll()

    // --- PWA hint: register a lightweight service worker if supported ---
    if('serviceWorker' in navigator){ try{ const swCode = `self.addEventListener('install',e=>self.skipWaiting());self.addEventListener('activate',e=>clients.claim());self.addEventListener('fetch',e=>{});`; const blob = new Blob([swCode],{type:'application/javascript'}); const url = URL.createObjectURL(blob); navigator.serviceWorker.register(url).catch(()=>{}); }catch(e){}
    }

  </script>
</body>
</html>
